---
import { H1 } from '@/components/Headings';
import { Search } from '@/components/Search';
import Layout from '@/layouts/Layout.astro';
import fs from 'fs/promises';
import { cwd } from 'process';
import { css } from 'styled-system/css';

export const prerender = true;

export const getSketchSlugs = async () => {
  const files = await fs.readdir(`${cwd()}/src/pages/sketches`);
  const filteredFiles = files.filter(file => file !== 'index.astro');
  const slugs = filteredFiles.map(file => file.replace('.astro', ''));

  return slugs;
};

const list = await getSketchSlugs();

const { pathname: path } = Astro.url;
---

<Layout title='Sketches' maxW='2xl'>
  <H1 class={css({ pb: 4 })}>Search Sketches</H1>
  <Search path={path} list={list} client:load />
</Layout>
