---
import { capitalCase } from "change-case";

import Sketch from "@/components/Sketch.astro";
import SketchLayout from "@/layouts/SketchLayout.astro";

export const prerender = true;

const { pathname } = Astro.url;
const title = capitalCase(pathname.split("/").pop() ?? "");
---

<script>
  import type { Draw } from "@/utils/p5";
  import { sketch } from "@/utils/p5";

  const dimensions: number[] = [2400, 2400];
  const padding: number[] = [40];
  const background = [255, 253, 252];
  const totalFrames = 240;

  const draw: Draw = (p5) => {
    p5.clear(0, 0, 0, 0);
    p5.frameRate(60);
    p5.background(background);
    p5.fill(0);
    p5.stroke(0);

    const margin = p5.width * 0.125;
    const yMid = p5.height * 0.5;
    const xStart = margin;
    const xEnd = p5.width - margin;
    const length = 30;

    Array.from({ length }, (_, i) => {
      const amp = Math.floor(p5.height * 0.175);
      const freq = p5.frameCount * 0.025 + i * 0.25;
      const x = p5.lerp(xStart, xEnd, i / (length - 1));
      const y = yMid + p5.sin(freq) * amp;

      p5.circle(x, y, p5.width * 0.00825);
    });
  };

  sketch({
    background,
    dimensions,
    draw,
    padding,
    saveAs: "gif",
    suffix: "simple",
    gifOptions: [
      totalFrames,
      {
        delay: 0,
        units: "frames",
      },
    ],
  });
</script>

<SketchLayout {title}>
  <Sketch />
</SketchLayout>
